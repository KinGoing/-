<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>canvas</title>
	<script type="text/javascript" src="digit.js"></script>
	<script type="text/javascript">
	var WINDOW_WIDTH=1200;
	var WINDOW_HEIGHT=500;
	var MARGIN_TOP=50;
	var MARGIN_LEFT=100;
	var R=8;
	var oldTime;
	var balls=[];
	const colors = ["#33B5E5","#0099CC","#AA66CC","#9933CC","#99CC00","#669900","#FFBB33","#FF8800","#FF4444","#CC0000"]
	window.onload=function(){
		var canvas=document.getElementById('canvas');
		var context=canvas.getContext('2d');
		//使用canvas绘图
		/*绘图步骤：基于状态*/
		/*context.beginPath();//开始画
			context.moveTo(100,100);//从
			context.lineTo(700,700);//到
			context.lineTo(100,700);//再到
			context.lineWidth=5;//线宽
			context.strokeStyle='red'//线条样式（颜色）
			context.stroke();//笔画

			context.fillStyle='blue';//填充色
			   contextontext.fill();//填充
		context.closePath();*///结束画,自动封闭图形（不一定成对出现！）

		/*context.beginPath();
			context.lineWidth=5;
			context.strokeStyle='#058';
			context.arc(300,300,200,0,1.5*Math.PI,false);//圆心X,圆心Y，半径，起始角度，终点角度，顺(false)逆(true)时针
			context.stroke();
		context.closePath();*/
		var ifn=new getShowTime();//oldTime
		ihours=ifn.hours();
		iminutes=ifn.minutes();
		iseconds=ifn.seconds();

		setInterval(function(){
			render(context);
			update();
		},50)
	}
	var getShowTime=function(){
		var data=new Date();
		this.hours=function(){
			return data.getHours()
		};
		this.minutes=function(){
			return data.getMinutes()
		};
		this.seconds=function(){
			return data.getSeconds()
		};
	}
	function update(){
		if (hours/10!=ihours/10) {
			//onsole.log(hours)
			addBalls( MARGIN_LEFT + 0 , MARGIN_TOP , parseInt(ihours/10) );
		}
		if ((hours%10)!=(ihours%10)) {
			//console.log(hours)
			addBalls( MARGIN_LEFT + 15*(R+1) , MARGIN_TOP , parseInt(ihours/10) );
		}
		if ((minutes/10)!=(iminutes/10)) {
			//console.log(minutes)
			addBalls( MARGIN_LEFT + 39*(R+1) , MARGIN_TOP , parseInt(iminutes/10) );
		}
		if ((minutes%10)!=(iminutes%10)) {
			//console.log(minutes)
			addBalls( MARGIN_LEFT + 54*(R+1) , MARGIN_TOP , parseInt(iminutes%10) );
		}
		if ((seconds/10)!=(iseconds/10)) {
			//console.log(seconds)
			addBalls( MARGIN_LEFT + 78*(R+1) , MARGIN_TOP , parseInt(iseconds/10) );
		}
		if ((seconds%10)!=(iseconds%10)) {
			//console.log(seconds)
			addBalls( MARGIN_LEFT + 93*(R+1) , MARGIN_TOP , parseInt(iseconds%10) );
		}
		ihours=hours;
		iminutes=minutes;
		iseconds=seconds;

		updateBalls();
	}
	function updateBalls(){
		for (var i = balls.length - 1; i >= 0; i--) {
			balls[i].x+=balls[i].vx;
			balls[i].y+=balls[i].vy;
			balls[i].vy+=balls[i].g;

			if (balls[i].y>=WINDOW_HEIGHT-R) {
				balls[i].y=WINDOW_HEIGHT-R;
				balls[i].vy=-balls[i].vy*0.75;
			}
		}
	}
	function addBalls(x,y,num){
		for (var i = digit[num].length - 1; i >= 0; i--) {
			for (var j = digit[num][i].length - 1; j >= 0; j--) {
				if(digit[num][i][j]){
					var aBall={
						x:x+j*2*(R+1)+(R+1),
						y:y+i*2*(R+1)+(R+1),
						g:1.5+Math.random(),
						vx:Math.pow(-1,Math.ceil(Math.random()*1000)) * 4,
                    	vy:-5,
                    	color: colors[ Math.floor( Math.random()*colors.length ) ]
					}
					balls.push( aBall );
				}
			}
		}
	}

	function render(cxt){
		var fn=new getShowTime();
		hours=fn.hours();
		minutes=fn.minutes();
		seconds=fn.seconds();
		canvas.width=WINDOW_WIDTH;
		canvas.height=WINDOW_HEIGHT;
		renderDigit(MARGIN_LEFT,MARGIN_TOP,parseInt(hours/10),cxt);//小时十位
		renderDigit(MARGIN_LEFT+15*(R+1),MARGIN_TOP,parseInt(hours%10),cxt);
		renderDigit(MARGIN_LEFT+30*(R+1),MARGIN_TOP,10,cxt);
		renderDigit(MARGIN_LEFT+39*(R+1),MARGIN_TOP,parseInt(minutes/10),cxt);
		renderDigit(MARGIN_LEFT+54*(R+1),MARGIN_TOP,parseInt(minutes%10),cxt);
		renderDigit(MARGIN_LEFT+69*(R+1),MARGIN_TOP,10,cxt);
		renderDigit(MARGIN_LEFT+78*(R+1),MARGIN_TOP,parseInt(seconds/10),cxt);
		renderDigit(MARGIN_LEFT+93*(R+1),MARGIN_TOP,parseInt(seconds%10),cxt);

		for (var i = balls.length - 1; i >= 0; i--) {
			cxt.fillStyle=balls[i].color;
			cxt.beginPath();
				cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
			cxt.closePath();
			cxt.fill();
		}
	}

	function renderDigit(x,y,num,cxt){
		cxt.fillStyle='rgba(0,102,153,.8)';

		for(var i=0;i<digit[num].length;i++){
			for(var j=0;j<digit[num][i].length;j++)
				if (digit[num][i][j]==1) {
					cxt.beginPath();
						cxt.arc(x+j*2*(R+1)+(R+1),y+i*2*(R+1)+(R+1),R,0,2*Math.PI);
					cxt.closePath();
					cxt.fill();
				}
		}
	}
	</script>

</head>
<body>
	<canvas id="canvas" style="border: 1px solid #ccc;display:block;margin:70px auto"></canvas>
</body>
</html>